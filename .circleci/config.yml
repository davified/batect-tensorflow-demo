version: 2.1

orbs:
  maven: circleci/maven@1.0.3

jobs:
  build-and-test:
    executor: maven/default
    steps:
      - checkout
      - setup_remote_docker:
          version: 19.03.13
      - run:
          command: ./batect setup
          name: Setup dependencies
      - run:
          command: ./batect unit_test
          name: Run unit tests
  train-model:
    executor: maven/default
    steps:
      - checkout
      - setup_remote_docker:
          version: 19.03.13
      - run:
          command: ./batect train_model
          name: Train ML model

workflows:
  main:
    jobs:
      - build-and-test
      - train-model:
          requires:
            - build-and-test
